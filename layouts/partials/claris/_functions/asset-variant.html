{{- $assetVariant := .Scratch.Get "claris.assets.variant" }}
{{- if not $assetVariant }}
  {{- $page := .Page }}
  {{- $template := "claris/_functions/asset-variant" }}

  {{- if $assetVariant }}
    {{- warnf "%s[%s]: claris.assets.variant=%v" $page $template $assetVariant }}
  {{- else }}

    {{- $outputFormat := partial "claris/_functions/output-format" . }}
    {{- $onlyMediaType := default "all" ($page.Param "onlyMediaType") }}
    {{- $mediaTypeList := (slice "all" "screen" "print") }}
    {{- if not (eq $onlyMediaType "all") }}
      {{- $mediaTypeList = (slice $onlyMediaType) }}
    {{- end }}

    {{- $contentTypeList := partialCached "claris/_functions/alternative-type" (dict "Page" $page "All" true) "All" .Type }}
    {{- $contentTypeList = slice "claris" }}
    {{/* {{- warnf "%s[%s]: contentTypeList=%v" $page $template $contentTypeList }} */}}
    {{- $contentType := index (last 1 $contentTypeList) 0 }}
    {{- $contentTypeListID := delimit $contentTypeList "-" }}
    {{- $assetStyle := "default" }}
    {{- $assetStyleSuffix := "" }}
    {{- with $assetStyle = ($page.Param "style") }}
      {{- if eq (printf "%T" .) "string" }}
        {{- if ne $assetStyle "default" }}
          {{- /* Append style name only if $assetStyle is not "default" */ -}}
          {{- $assetStyleSuffix = printf "_style-%s" $assetStyle }}
          {{- warnf "%s[%s]: non-default assetStyle=%v: defined assetStyleSuffix=%v" $page $template $assetStyle $assetStyleSuffix }}
        {{- end }}
      {{- else }}
        {{- /* Append hash if $assetStyle is not a simple string */ -}}
        {{- $assetStyleSuffix = printf "_style-%s" ($assetStyle | jsonify | sha256) }}
        {{- warnf "%s[%s]: non-string assetStyle=%v: defined assetStyleSuffix=%v" $page $template $assetStyle $assetStyleSuffix }}
      {{- end }}
      {{- with $assetStyleSuffix }}
        {{- $contentTypeListID = printf "%s%s" $contentTypeListID . }}
      {{- end }}
    {{- end }}
    {{- $envDevel := partialCached "claris/_functions/is-build-environment" "devel" "devel" hugo.Environment }}
    {{- $envProd := partialCached "claris/_functions/is-build-environment" "prod" "prod" hugo.Environment }}
    {{- $minifyBundles := $envProd }}

    {{- $assetVariant = (dict
      "OutputFormat" $outputFormat
      "OnlyMediaType" ($page.Param "onlyMediaType")
      "MediaTypeList" $mediaTypeList
      "ContentType" $contentType
      "ContentTypeList" $contentTypeList
      "ContentTypeListID" $contentTypeListID
      "AssetStyle" $assetStyle
      "AssetStyleSuffix" $assetStyleSuffix
      "BundleParams" (dict
        "MinifyBundles" $minifyBundles
      )
    ) -}}

    {{- .Scratch.Set "claris.assets.variant" $assetVariant }}
  {{- end }}
{{- end }}

{{- return $assetVariant }}
