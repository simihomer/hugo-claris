{{- $page := .Page }}
{{- $meta := .Meta }}
{{- $template := "claris/_components/list" }}
{{- $debug := default false .Debug }}
{{/* {{- $debug = or $debug (not (not (findRE `leadership` $page.RelPermalink) ) ) }} */}}

{{- if $debug }}
  {{- warnf "%s[%s]: .ListParams=%v" $page $template .ListParams }}
{{- end }}

{{- $listParams := default dict .ListParams }}

{{- $excerptPartial := default false .Partial }}
{{- $listLayout := default "grid" .ListLayout }}
{{- $headingLevel := default 2 .HeadingLevel }}
{{- $containerClass := default "content_multicolumn content" .ContainerClass }}

{{- $mainSection := (in ($page.Param "mainSections") $page.Section) -}}

{{- with $meta }}
{{- else }}
  {{- if $debug }}
    {{- warnf "%s[%s]: Rendering page with type=%v kind=%v listParams=%v"
        $page $template $page.Type $page.Kind $listParams }}
  {{- end }}
  {{- $meta = partial "claris/_functions/meta/list" (dict "Page" $page "Debug" $debug "ListParams" $listParams) }}
{{- end }}

{{- $itemsMeta := $meta.List.Data.Items }}

{{- $itemType := default "section" $meta.List.Data.ItemType }}

{{/* {{- if $debug }}
  {{- warnf "%s[%s]: itemsMeta=%v itemType=%v excerptPartial=%v listLayout=%v headingLevel=%v containerClass=%v"
      $page $template $itemsMeta $itemType $excerptPartial $listLayout $headingLevel $containerClass }}
{{- end }} */}}

{{- with $itemsMeta }}

  {{- if (eq $listLayout "grid") }}
    {{- $excerptPartial = default $excerptPartial "claris/_components/excerpt" }}
    <div class="{{ $containerClass }}{{ if $mainSection }} main-section{{ end }}">
      <div class="excerpt_grid">
  {{- else if (eq $listLayout "list") }}
    <ul class="content_list">
  {{- else }}
    {{- errorf "%s[%s]: Invalid .ListLayout=%v" $page $template $listLayout }}
  {{- end }}

  {{- $paginated := $itemsMeta }}
  <!-- Paginator is only supported if kind is section or taxonomy
      https://gohugo.io/templates/pagination/#list-paginator-pages -->
  {{/* {{- if (in (slice "section" "taxonomy") $page.Kind) }}
    {{- $paginated = ($page.Paginate $itemsMeta).Pages }}
  {{- end }} */}}
  {{- with $paginated }}
    {{- range . }}
      {{/* {{- warnf "%s[%s]: Listing page=%v with .Single.Data=%v" $page $template .Single.Page .Single.Data }} */}}
      {{- if $excerptPartial }}
        {{ partial $excerptPartial (dict
          "Page" .Single.Page
          "Meta" .
          "ItemType" $itemType
          "HeadingLevel" $headingLevel
          "RelativeDates" false
          "ShowTags" false
        ) }}
      {{- else }}
        <li><a href="{{ .Single.Page.RelPermalink }}" title="{{ .Single.Page.Title }}">{{ .Single.Page.Title }}</a></li>
      {{- end }}
    {{- end }}
    {{- if (eq $listLayout "grid") }}
    </div>
    {{- end }}
    {{/* {{- if and (in (slice "section" "taxonomy") $page.Kind) (gt (len $itemsMeta) ($page.Param "paginate") ) }}
    <div class="pagination_grid">
      {{- template "_internal/pagination.html" $page }}
    </div>
    {{- end }} */}}
  {{- else }}
    {{- errorf "%s[%s]: page.Paginate returned %v. $itemsMeta=%v" $page $template $paginated $itemsMeta }}
  {{- end }}

  {{- if (eq $listLayout "grid") }}
    </div>
  {{- else if (eq $listLayout "list") }}
    </ul>
  {{- end }}
{{/* {{- else }}
  {{- warnf "%s[%s]: Nothing to list: .Items=%v" $page $template $itemsMeta }} */}}
{{- end }}
